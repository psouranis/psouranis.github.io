<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Python metaclasses | Panagiotis Souranis </title> <meta name="author" content="Panagiotis Souranis"> <meta name="description" content="Python metaclasses"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?e085e6e336e4118fa5acc3f249df0647" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://psouranis.github.io/blog/2025/metaclasses/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Panagiotis</span> Souranis </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Curriculum Vitae </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Python metaclasses</h1> <p class="post-meta"> Created in June 11, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> Python</a>   <a href="/blog/tag/metaclasses"> <i class="fa-solid fa-hashtag fa-sm"></i> Metaclasses</a>   ·   <a href="/blog/category/python"> <i class="fa-solid fa-tag fa-sm"></i> Python</a> </p> </header> <article class="post-content"> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h2"><a href="#python-classes">Python Classes</a></li> <li class="toc-entry toc-h2"><a href="#metaclasses">Metaclasses</a></li> <li class="toc-entry toc-h2"> <a href="#use-cases">Use cases</a> <ul> <li class="toc-entry toc-h3"><a href="#use-case-no-1---singletons">Use case no. 1 - Singletons</a></li> <li class="toc-entry toc-h3"><a href="#use-case-no-2---controlling-class-methods">Use case no. 2 - Controlling Class Methods</a></li> <li class="toc-entry toc-h3"><a href="#use-case-no-3---changing-class-namespace">Use case no. 3 - Changing Class Namespace</a></li> <li class="toc-entry toc-h3"><a href="#use-case-no-4---manipulating-mro">Use Case no. 4 - Manipulating MRO</a></li> <li class="toc-entry toc-h3"><a href="#use-case-no-5---class-dunder-methods">Use Case no. 5 - Class Dunder Methods</a></li> <li class="toc-entry toc-h3"><a href="#one-more-example---abstract-base-class">One More Example - Abstract Base Class</a></li> </ul> </li> <li class="toc-entry toc-h2"><a href="#references">References</a></li> </ul> </div> <hr> <div id="markdown-content"> <p>This post serves as a reference from a great talk from PyCon US (<a href="https://www.youtube.com/watch?v=fEm0vi8SpkI" rel="external nofollow noopener" target="_blank">Link</a>) where Jason C. McDonald discusses Python’s metaclasses. The goal of this post is to summarize what was said in that video and put it in a readable format.</p> <h2 id="python-classes">Python Classes</h2> <p><br></p> <div style="text-align: center;"> <img src="/assets/post_images/metaclasses/blueprint.png" style="width: 50%; height: auto;"> </div> <p><br></p> <p>Alright, let’s first start with something that we are all familiar. Python Classes. Everyone used them at some time and everyone is familiar with them. Python classes are like blueprints. You can think of a blueprint of a house that is built where you can then use it to build multiple houses and each house will look like the blueprint and if you change the blueprint then each house you create from now on will be different but if you change one of the houses you are only changing that one house and it’s not affecting the others.</p> <p>In Python, we say everything is an <code class="language-plaintext highlighter-rouge">object</code>. And so classes are objects too. Going back to our analogy of the blueprint, if you try to apply that thinking to the blueprint itself you will realize that blueprints are based on templates. You can have a template for example that creates blueprints of houses where the specs are on meters or a template that you create blueprints of houses in feet.</p> <p>So those classes (blueprints) are still objects and they are instances of the <code class="language-plaintext highlighter-rouge">metaclass</code> which is the template that I mentioned above. So we can have multiple templates but the one built-in we use everytime in Python is called <code class="language-plaintext highlighter-rouge">type</code>.</p> <p>We have used <code class="language-plaintext highlighter-rouge">type</code> multiple times but for different reason. Like for example when we want to check the type of an instance</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td> <td class="rouge-code"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1"># &lt;class 'numpy.ndarray'&gt;
</span></pre></td> </tr></tbody></table></code></pre></div></div> <p>You notice that the type is <code class="language-plaintext highlighter-rouge">class</code>!. So <code class="language-plaintext highlighter-rouge">type</code> is actually Python’s built-in default metaclass. And the thing is that you can actually create a class dynamically using <code class="language-plaintext highlighter-rouge">type</code></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> <td class="rouge-code"><pre><span class="nf">type</span><span class="p">(</span><span class="sh">"</span><span class="s">Foo</span><span class="sh">"</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{})</span>
<span class="n">__main__</span><span class="p">.</span><span class="n">Foo</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <blockquote> <p>The <code class="language-plaintext highlighter-rouge">class</code> statement isn’t just syntatictic sugar, it does some extra things, like setting a <code class="language-plaintext highlighter-rouge">__qualname__</code> and <code class="language-plaintext highlighter-rouge">__doc__</code> properties.</p> </blockquote> <p>The funny thing about <code class="language-plaintext highlighter-rouge">type</code> is that is of type <code class="language-plaintext highlighter-rouge">type</code> .</p> <ol> <li>Name of the classes.</li> <li>Bases (Inheritance).</li> <li>Keyword arguments (such as <code class="language-plaintext highlighter-rouge">metaclass</code>)</li> </ol> <p>You can see more about dynamic creation of a class at <a href="https://docs.python.org/3/reference/datamodel.html" rel="external nofollow noopener" target="_blank">datamodel</a>.</p> <p>Alright, now that we have a graps of what metaclasses are, let’s see what the use cases for using one are since this is what we are interested in.</p> <h2 id="metaclasses">Metaclasses</h2> <p>What does a metaclass do? There are 4 things a metaclass manages in Python.</p> <p><br></p> <div style="text-align: center;"> <img src="/assets/post_images/metaclasses/metaclass_do.png" style="width: 50%; height: auto;"> </div> <p><br></p> <ol> <li>The first is class instantiation.</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> <td class="rouge-code"><pre><span class="nf">__call__</span><span class="p">()</span>
<span class="nf">__new__</span><span class="p">()</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>Metaclass calls <code class="language-plaintext highlighter-rouge">__call__</code> which in turn calls <code class="language-plaintext highlighter-rouge">__new__</code> from <code class="language-plaintext highlighter-rouge">Class</code> (and if it returned an instance of <code class="language-plaintext highlighter-rouge">Class</code> it will also call <code class="language-plaintext highlighter-rouge">Class.__init__</code>)</p> <p><br></p> <div style="text-align: center;"> <img src="/assets/post_images/metaclasses/instance_creation.png" style="width: 50%; height: auto;"> </div> <p><br></p> <ol> <li>Class Attribute Storage.</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> <td class="rouge-code"><pre><span class="nd">@classmethod</span>
<span class="nf">__prepare__</span><span class="p">()</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>This method is called before the class body is executed and it must return a dictionary-like object that’s used as the local namespace for all the code from the class body. It was added in Python 3.0, see PEP-3115.</p> <p>If your <code class="language-plaintext highlighter-rouge">__prepare__</code> returns an object <code class="language-plaintext highlighter-rouge">x</code> then this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="nb">type</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>Will make the following changes to x:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> <td class="rouge-code"><pre><span class="n">x</span><span class="p">[</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span><span class="p">[</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">x</span><span class="p">[</span><span class="sh">'</span><span class="s">c</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <ol> <li>Method Resolution Order.</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre><span class="nf">mro</span><span class="p">()</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">type</code> metaclass defines the <code class="language-plaintext highlighter-rouge">type.mro()</code> which sets the method resolution order for its instances. It is called at class instantiation, and its result is stored in <code class="language-plaintext highlighter-rouge">__mro__</code> (This attribute is a tuple of classes that are considered when looking for base classes during method resolution.).</p> <ol> <li>Inheritance.</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> <td class="rouge-code"><pre><span class="nf">__isinstancecheck__</span><span class="p">()</span>
<span class="nf">__subclasscheck__</span><span class="p">()</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">__isinstancecheck__</code> and <code class="language-plaintext highlighter-rouge">__subclasscheck__</code> are powerful metaclass methods that allow you to customize how the built-in isinstance() and issubclass() functions behave for classes defined with that metaclass. They provide a way to inject custom logic for determining object and class relationships, going beyond the standard inheritance model.</p> <h2 id="use-cases">Use cases</h2> <p>Next and most importantly, we will explore some use cases that the metaclasses make sense to use.</p> <h3 id="use-case-no-1---singletons">Use case no. 1 - Singletons</h3> <p>Singletons allow us to make sure that we instantiate a class only once. This could be useful for cases that we want a global shared instance for example.</p> <p>Let’s see how we can create a <code class="language-plaintext highlighter-rouge">Singleton</code> metaclass.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>

  <span class="n">_instance</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cls</span><span class="p">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cls</span><span class="p">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nf">super</span><span class="p">().</span><span class="nf">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">_instance</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>To make a metaclass we inherit from <code class="language-plaintext highlighter-rouge">type</code>. Important to remember: An <code class="language-plaintext highlighter-rouge">instance</code> method on a metaclass is a <code class="language-plaintext highlighter-rouge">classmethod</code> on a class. So this <code class="language-plaintext highlighter-rouge">__call__</code> method will be called when we create <strong>and</strong> instantiate a class that inherits from <code class="language-plaintext highlighter-rouge">Singleton</code> metaclass.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Once</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">Singleton</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="n">once</span> <span class="o">=</span> <span class="nc">Once</span><span class="p">(</span><span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">)</span>
<span class="n">twice</span> <span class="o">=</span> <span class="nc">Once</span><span class="p">(</span><span class="sh">"</span><span class="s">Jason</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">once</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="c1"># Bob
</span><span class="nf">print</span><span class="p">(</span><span class="n">twice</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="c1"># Bob
</span></pre></td> </tr></tbody></table></code></pre></div></div> <h3 id="use-case-no-2---controlling-class-methods">Use case no. 2 - Controlling Class Methods</h3> <p>You could…</p> <ol> <li>Add decorators to all class methods.</li> <li>Validate class methods.</li> <li>Prevent some class methods.</li> </ol> <p>In other words, this is as close as Python gets to compiler time errors. Let’s say for example that we have a metaclass called <code class="language-plaintext highlighter-rouge">Unaddable</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Unaddable</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">__add__</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
      <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span><span class="sh">"</span><span class="s">Can</span><span class="sh">'</span><span class="s">t override __add__</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="nf">super</span><span class="p">().</span><span class="nf">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>We don’t want to fail when we instantiate an object or when we try to call <code class="language-plaintext highlighter-rouge">__add__</code>. We literally don’t want any classes using this metaclass that have <code class="language-plaintext highlighter-rouge">__add__</code> defined at all.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Misbehaving</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">Unaddable</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

  <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="nc">Misbehaving</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">other</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>As soon as I run this code (without instantiating anything) we get a <code class="language-plaintext highlighter-rouge"># TypeError: Can't override __add__</code> as soon as I run the code. This could be used in cases that is very crucial that I should not define something I’m not suppose to.</p> <h3 id="use-case-no-3---changing-class-namespace">Use case no. 3 - Changing Class Namespace</h3> <p>In Python, we typically store everything in a class in a dictionary, which is all well and good, but sometimes you want to store it a little differently.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">EnumType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>

  <span class="nd">@classmethod</span>
  <span class="k">def</span> <span class="nf">__prepare__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">metacls</span><span class="p">.</span><span class="nf">_check_for_existing_members_</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
    <span class="n">enum_dict</span> <span class="o">=</span> <span class="nc">EnumDict</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
    <span class="n">member_type</span><span class="p">,</span> <span class="n">first_enum</span> <span class="o">=</span> <span class="n">metacls</span><span class="p">.</span><span class="nf">_get_mixins_</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">first_enum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">enum_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">_generate_next_value_</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">first_enum</span><span class="p">,</span> <span class="sh">'</span><span class="s">_generate_next_value_</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">enum_dict</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>That’s how <code class="language-plaintext highlighter-rouge">Enum</code> works. It overrides the dictionary that stores those class attributes. Cause if you think about how <code class="language-plaintext highlighter-rouge">Enum</code> works, it’s just a class with a bunch of class attributes. No member functions or anything. And that’s because we are using the <code class="language-plaintext highlighter-rouge">__prepare__</code> method in the metaclass to change how those class attributes are being stored.</p> <h3 id="use-case-no-4---manipulating-mro">Use Case no. 4 - Manipulating MRO</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Arcana</span>

  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sh">"</span><span class="s">Arcana</span><span class="sh">"</span>

  <span class="k">def</span> <span class="nf">magic_word</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Abracadabra</span><span class="sh">"</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>Let’s say that I want my class to look at the following class as an absolute last resort. I don’t want to override anything, not even an object. But if it’s not anywhere at all, I want to check at the code above last.</p> <p>One way to do that, is to define a metaclass and change the <code class="language-plaintext highlighter-rouge">mro</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">KnowsArcana</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">mro</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="nf">super</span><span class="p">().</span><span class="nf">mro</span><span class="p">(),</span> <span class="n">Arcana</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">KnowsArcana</span><span class="p">):</span>
  <span class="k">pass</span>

<span class="n">my_obj</span> <span class="o">=</span> <span class="nc">MyClass</span><span class="p">()</span>
<span class="n">my_obj</span><span class="p">.</span><span class="nf">magic_word</span><span class="p">()</span> <span class="c1"># "Abracadabra!"
</span><span class="nf">print</span><span class="p">(</span><span class="nf">repr</span><span class="p">(</span><span class="n">my_obj</span><span class="p">))</span> <span class="c1"># "&lt;__main__.MyClass object at ...&gt;"
</span></pre></td> </tr></tbody></table></code></pre></div></div> <p>You see that if I try to call <code class="language-plaintext highlighter-rouge">magic_word()</code> it finds it but if I try to use <code class="language-plaintext highlighter-rouge">print</code> it will use the default <code class="language-plaintext highlighter-rouge">__repr__</code> of <code class="language-plaintext highlighter-rouge">type</code>.</p> <h3 id="use-case-no-5---class-dunder-methods">Use Case no. 5 - Class Dunder Methods</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">AddressBook</span><span class="p">:</span>
  <span class="n">mutable_dict</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">()</span>

  <span class="nd">@classmethod</span>
  <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">mutable_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
      <span class="k">return</span> <span class="nf">super</span><span class="p">().</span><span class="nf">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    
  <span class="nd">@classmethod</span>
  <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span>
      <span class="n">cls</span><span class="p">.</span><span class="n">mutable_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> 

<span class="n">AddressBook</span><span class="p">.</span><span class="nf">store</span><span class="p">({</span><span class="sh">"</span><span class="s">Bob Smith</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bob@example.com</span><span class="sh">"</span><span class="p">})</span>
<span class="nf">print</span><span class="p">(</span><span class="n">AddressBook</span><span class="p">.</span><span class="n">Bob_Smith</span><span class="p">)</span>

<span class="c1"># AttributeError: type object 'AddressBook' has no attribute 'Bob_Smith'
</span></pre></td> </tr></tbody></table></code></pre></div></div> <p>If you want to override dunder methods of the class you need to do it on the metaclass.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">DottedDict</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>

  <span class="nd">@classmethod</span>
  <span class="k">def</span> <span class="nf">__prepare__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="sh">'</span><span class="s">mutable_dict</span><span class="sh">'</span><span class="p">:</span> <span class="nf">dict</span><span class="p">()</span>
    <span class="p">}</span>

  <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">mutable_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">return</span> <span class="nf">super</span><span class="p">().</span><span class="nf">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span>
      <span class="n">cls</span><span class="p">.</span><span class="n">mutable_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="k">class</span> <span class="nc">AddressBook</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">DottedDict</span><span class="p">):</span>
  <span class="k">pass</span>

<span class="n">AddressBook</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="sh">"</span><span class="s">Bob Smith</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bob@example.com</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Fred Wright</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">fred@example.com</span><span class="sh">"</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">AddressBook</span><span class="p">.</span><span class="n">Bob_Smith</span><span class="p">)</span> <span class="c1"># "bob@example.com"
</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <h3 id="one-more-example---abstract-base-class">One More Example - Abstract Base Class</h3> <p>Everytime you use an abstract base class, you are using a metaclass. This is the python’s source code for <code class="language-plaintext highlighter-rouge">ABCMeta</code></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td> <td class="rouge-code"><pre><span class="k">class</span> <span class="nc">ABCMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">cls</span> <span class="o">=</span> <span class="nf">super</span><span class="p">().</span><span class="nf">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="nf">_abc_init</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cls</span>
  
  <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">_abc_register</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__instancecheck__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">_abc_instancecheck</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__subclasscheck__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">_abc_subclasscheck</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_abc_registry_clear</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="nf">_reset_registry</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_abc_caches_clear</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="nf">_reset_caches</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>The most crucial parts of this metaclass is the <code class="language-plaintext highlighter-rouge">__instancecheck__</code> and <code class="language-plaintext highlighter-rouge">__subclasscheck__</code>.</p> <h2 id="references">References</h2> <ul> <li><a href="https://www.youtube.com/watch?v=fEm0vi8SpkI" rel="external nofollow noopener" target="_blank">Metaclasses Demystified - Jason C. McDonald</a></li> <li><a href="https://blog.ionelmc.ro/2015/02/09/understanding-python-metaclasses/" rel="external nofollow noopener" target="_blank">Understanding Python’s Metaclasses</a></li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/numpy-numexpr-numba-cython-copy/">Numpy or ... ? What can I choose?</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/getitem/">__getitem__ vs __getitems__. A nice trick for Pytorch</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/pruning-techniques-part2/">Pruning techniques - Optimizing machine learning models Part 2</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/pruning-techniques/">Pruning techniques - Optimizing machine learning models Part 1</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/tail-call-optimization/">Tail Call Optimization</a> </li> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"psouranis/psouranis.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Panagiotis Souranis. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-projects",title:"Projects",description:"A growing collection of your cool projects.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-repositories",title:"Repositories",description:"",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"nav-curriculum-vitae",title:"Curriculum Vitae",description:"",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"post-python-metaclasses",title:"Python metaclasses",description:"Python metaclasses",section:"Posts",handler:()=>{window.location.href="/blog/2025/metaclasses/"}},{id:"post-numpy-or-what-can-i-choose",title:"Numpy or ... ? What can I choose?",description:"Numpy optimizations",section:"Posts",handler:()=>{window.location.href="/blog/2025/numpy-numexpr-numba-cython-copy/"}},{id:"post-getitem-vs-getitems-a-nice-trick-for-pytorch",title:"__getitem__ vs __getitems__. A nice trick for Pytorch",description:"Torch indexing trick",section:"Posts",handler:()=>{window.location.href="/blog/2025/getitem/"}},{id:"post-pruning-techniques-optimizing-machine-learning-models-part-2",title:"Pruning techniques - Optimizing machine learning models Part 2",description:"Pruning Techniques Part 2",section:"Posts",handler:()=>{window.location.href="/blog/2025/pruning-techniques-part2/"}},{id:"post-pruning-techniques-optimizing-machine-learning-models-part-1",title:"Pruning techniques - Optimizing machine learning models Part 1",description:"Pruning Techniques",section:"Posts",handler:()=>{window.location.href="/blog/2025/pruning-techniques/"}},{id:"post-tail-call-optimization",title:"Tail Call Optimization",description:"Tail Call Optimization",section:"Posts",handler:()=>{window.location.href="/blog/2025/tail-call-optimization/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%73%6F%75%72%61%6E%69%73%70%61%6E%6F%73@%67%6D%61%69%6C.%63%6F%6D","_blank")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>